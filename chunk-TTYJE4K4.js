import{a as N}from"./chunk-SA73PTZG.js";import{a as M}from"./chunk-2O4QYMPI.js";import{b as k,h as F}from"./chunk-BPO3UDND.js";import"./chunk-IGDONR4E.js";import{$ as v,Bb as j,Jb as x,Lb as A,Mb as D,N as n,O as u,P as d,T as f,Z as p,_,ab as w,eb as y,ga as S,ob as b,pb as I,qa as C,sa as g,u as m}from"./chunk-XKQUAFE5.js";var T={formId:"schoolsession",title:"Session",components:[{name:"Date",key:"start",fields:[{name:"Placeholder",value:"fill session start"},{name:"Label",value:"Date start"}]},{name:"Date",key:"end",fields:[{name:"Placeholder",value:"fill session end"},{name:"Label",value:"Date end"}]}]};function R(r,e){if(r&1&&C(0),r&2){let U=e.$implicit,t=S();g(" ",t.courseName(U.course)," ")}}var h=(()=>{let e=class e{get hasAccess(){return!!this.course&&(this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher"))}get rows(){return this.course?this._schoolsessionService.schoolsessionsByCourse[this.course]:this._schoolsessionService.schoolsessions}constructor(t,o,s,c,l,q,B,L){this._translate=t,this._schoolsessionService=o,this._schoolcourseService=s,this._alert=c,this._form=l,this._core=q,this._router=B,this._us=L,this.columns=["course","status","start","end"],this.course=this._router.url.includes("/sessions/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schoolsession",T),this.config={create:this.hasAccess?()=>{this._form.modal(this.form,{label:"Create",click:(i,a)=>{this._preCreate(i),this._schoolsessionService.create(i),a()}})}:null,update:this.hasAccess?i=>{this._form.modal(this.form,[],i).then(a=>{this._core.copy(a,i),this._schoolsessionService.update(i)})}:null,delete:this.hasAccess?i=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schoolsession?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schoolsessionService.delete(i)}}]})}:null,buttons:[this.hasAccess?{icon:"cloud_download",click:i=>{this._form.modalUnique("schoolsession","url",i)}}:null,{icon:"card_membership",hrefFunc:i=>this._roleUrl()+"certificates/session/"+i._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]}}courseName(t){return this._schoolcourseService.doc(t).name}_bulkManagement(t=!0){return()=>{this._form.modalDocs(t?[]:this.rows).then(o=>{if(t)for(let s of o)this._preCreate(s),this._schoolsessionService.create(s);else{for(let s of this.rows)o.find(c=>c._id===s._id)||this._schoolsessionService.delete(s);for(let s of o){let c=this.rows.find(l=>l._id===s._id);c?(this._core.copy(s,c),this._schoolsessionService.update(c)):(this._preCreate(s),this._schoolsessionService.create(s))}}})}}_preCreate(t){delete t.__created,t.course=this.course}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}};e.\u0275fac=function(o){return new(o||e)(n(j),n(N),n(k),n(b),n(x),n(I),n(w),n(M))},e.\u0275cmp=u({type:e,selectors:[["ng-component"]],standalone:!1,decls:2,vars:3,consts:[["title","Sessions",3,"columns","config","rows"],["cell","course"]],template:function(o,s){o&1&&(_(0,"wtable",0),f(1,R,1,1,"ng-template",1),v()),o&2&&p("columns",s.columns)("config",s.config)("rows",s.rows)},dependencies:[D,A],encapsulation:2});let r=e;return r})();var E=[{path:"",component:h},{path:":course",component:h}],te=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=d({type:e}),e.\u0275inj=m({imports:[y.forChild(E),F]});let r=e;return r})();export{te as SessionsModule};

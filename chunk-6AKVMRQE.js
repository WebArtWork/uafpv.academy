import{a as P}from"./chunk-WNI66HZL.js";import{a as A}from"./chunk-2O4QYMPI.js";import{b as k,h as q}from"./chunk-BPO3UDND.js";import"./chunk-IGDONR4E.js";import{Bb as y,Jb as b,Mb as I,N as c,O as f,P as _,Z as p,aa as v,ab as g,eb as C,ob as w,pb as S,u as d}from"./chunk-XKQUAFE5.js";var s={formId:"schoolcourse",title:"Schoolcourse",components:[{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Photo"}]},{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill course title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill course description"},{name:"Label",value:"Description"}]},{name:"Select",key:"requiredCourse",hidden:!0,fields:[{name:"Placeholder",value:"Select required \u0441ourse"},{name:"Label",value:"Required Course"},{name:"Multiple",value:!0},{name:"Items",value:[]}]},{name:"Select",key:"suggestedCourse",hidden:!0,fields:[{name:"Placeholder",value:"Select suggested \u0441ourse"},{name:"Label",value:"Suggested Course"},{name:"Multiple",value:!0},{name:"Items",value:[]}]},{name:"Number",key:"duration",fields:[{name:"Placeholder",value:"set course duration"},{name:"Label",value:"Duration"}]},{name:"Number",key:"cost",fields:[{name:"Placeholder",value:"set course cost"},{name:"Label",value:"Cost"}]},{name:"Tags",key:"learning",fields:[{name:"Button",value:"Add what we are learning"},{name:"Placeholder",value:"fill learnings"},{name:"Label",value:"What student will learn"}]},{name:"Tags",key:"included",fields:[{name:"Button",value:"Add what is included"},{name:"Placeholder",value:"fill included"},{name:"Label",value:"Included"}]},{name:"Tags",key:"requirements",fields:[{name:"Button",value:"Add what is required to know"},{name:"Placeholder",value:"fill requirements"},{name:"Label",value:"Requirements"}]},{name:"Select",key:"status",fields:[{name:"Items",value:["Active","Inactive"]},{name:"Placeholder",value:"choose course status"},{name:"Label",value:"Status"},{name:"Multiple",value:!1}]},{name:"Select",key:"knowledge",hidden:!0,fields:[{name:"Items",value:[]},{name:"Placeholder",value:"choose course knowledge"},{name:"Label",value:"Knowledge"},{name:"Name",value:"title"}]}]};var m=(()=>{let t=class t{get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}get rows(){return this.school?this._schoolcourseService.schoolcoursesBySchool[this.school]:this._schoolcourseService.schoolcoursesByAuthor[this._us.user._id]}constructor(r,i,o,a,u,B,L,j){this._schoolcourseService=r,this._schoolknowledge=i,this._translate=o,this._alert=a,this._form=u,this._core=B,this._router=L,this._us=j,this.columns=["name","duration","cost","status"],this.school=this._router.url.includes("/courses/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schoolcourse",s),this.config={create:this.hasAccess?()=>{this.school||(this._form.getComponent(s,"suggestedCourse").hidden=!0,this._form.getComponent(s,"requiredCourse").hidden=!0),this._form.modal(this.form,{label:"Create",click:(e,h)=>{this._preCreate(e),this._schoolcourseService.create(e),h()}})}:null,update:this.hasAccess?e=>{this.school||(e.school?(this._form.getComponent(s,"suggestedCourse").hidden=!1,this._form.setValue(s,"suggestedCourse","Items",this._schoolcourseService.schoolcoursesBySchool[e.school]),this._form.getComponent(s,"requiredCourse").hidden=!1,this._form.setValue(s,"requiredCourse","Items",this._schoolcourseService.schoolcoursesBySchool[e.school])):(this._form.getComponent(s,"suggestedCourse").hidden=!0,this._form.getComponent(s,"requiredCourse").hidden=!0)),this._form.modal(this.form,[],e).then(h=>{this._core.copy(h,e),this._schoolcourseService.update(e)})}:null,delete:this.hasAccess?e=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schoolcourse?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schoolcourseService.delete(e)}}]})}:null,buttons:[this.hasAccess?{icon:"arrow_upward",click:e=>{let h=this.rows.findIndex(l=>l._id===e._id);h&&(this.rows.splice(h,1),this.rows.splice(h-1,0,e));for(let l=0;l<this.rows.length;l++)this.rows[l].order!==l&&(this.rows[l].order=l,this._schoolcourseService.update(this.rows[l]))}}:null,this.hasAccess?{icon:"cloud_download",click:e=>{this._form.modalUnique("schoolcourse","url",e)}}:null,{icon:"event",hrefFunc:e=>this._roleUrl()+"sessions/"+e._id},{icon:"work",hrefFunc:e=>this._roleUrl()+"lessons/"+e._id},{icon:"assignment",hrefFunc:e=>this._roleUrl()+"tests/course/"+e._id},{icon:"card_membership",hrefFunc:e=>this._roleUrl()+"certificates/course/"+e._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]},this.onKnowledge=this._core.on("schoolknowledge_get").subscribe(()=>{this.school&&(s.components[5].hidden=!1,s.components[5].fields[0].value.push(...this._schoolknowledge.schoolknowledgesBySchool[this.school]))}),this._core.onComplete("schoolcourse_loaded").then(()=>{this.school&&(this._form.getComponent(s,"suggestedCourse").hidden=!1,this._form.setValue(s,"suggestedCourse","Items",this._schoolcourseService.schoolcoursesBySchool[this.school]),this._form.getComponent(s,"requiredCourse").hidden=!1,this._form.setValue(s,"requiredCourse","Items",this._schoolcourseService.schoolcoursesBySchool[this.school]))})}ngOnDestroy(){this.onKnowledge.unsubscribe()}_bulkManagement(r=!0){return()=>{this._form.modalDocs(r?[]:this.rows).then(i=>{if(r)for(let o of i)this._preCreate(o),this._schoolcourseService.create(o);else{for(let o of this.rows)i.find(a=>a._id===o._id)||this._schoolcourseService.delete(o);for(let o of i){let a=this.rows.find(u=>u._id===o._id);a?(this._core.copy(o,a),this._schoolcourseService.update(a)):(this._preCreate(o),this._schoolcourseService.create(o))}}})}}_preCreate(r){delete r.__created,this.school&&(r.school=this.school)}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}};t.\u0275fac=function(i){return new(i||t)(c(k),c(P),c(y),c(w),c(b),c(S),c(g),c(A))},t.\u0275cmp=f({type:t,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Courses",3,"columns","config","rows"]],template:function(i,o){i&1&&v(0,"wtable",0),i&2&&p("columns",o.columns)("config",o.config)("rows",o.rows)},dependencies:[I],encapsulation:2});let n=t;return n})();var M=[{path:"",component:m},{path:":schoolcourse",component:m}],H=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=d({imports:[C.forChild(M),q]});let n=t;return n})();export{H as CoursesModule};

import{a as U}from"./chunk-2TNFNGTP.js";import{a as O}from"./chunk-2O4QYMPI.js";import{h as R}from"./chunk-BPO3UDND.js";import"./chunk-IGDONR4E.js";import{$ as h,Bb as D,Hb as N,Jb as C,K as q,Mb as E,N as r,O as v,Oa as F,P as I,Pa as j,T as b,Z as m,_ as u,a as T,aa as S,ab as Q,ea as k,eb as L,fa as d,ga as a,lb as P,ob as M,pb as y,qa as w,u as A,ub as B,wb as V,y as f,z as _}from"./chunk-XKQUAFE5.js";var W={formId:"schooltest",title:"Schooltest",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill tests title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill tests description"},{name:"Label",value:"Description"}]},{name:"Number",key:"duration",fields:[{name:"Placeholder",value:"set tests duration"},{name:"Label",value:"Duration"}]}]};function X(i,o){if(i&1){let l=k();u(0,"wform",3),d("wChange",function(){f(l);let t=a(2);return _(t.change())}),h()}if(i&2){let l=a().$implicit,e=a();m("submition",l)("config",e.form)}}function Z(i,o){if(i&1){let l=k();u(0,"div")(1,"wbutton",1),d("click",function(){let t=f(l).index,s=a();return s.questionIndex=t,_(s.change())}),w(2,"Edit question"),h(),b(3,X,1,2,"wform",2),u(4,"wbutton",1),d("click",function(){let t=f(l).index,s=a();return s.test.questions.splice(t,1),_(s.update())}),w(5,"Remove question"),h()()}if(i&2){let l=o.index,e=a();q(3),m("ngIf",e.questionIndex===l)}}var Y=(()=>{let o=class o{get questions(){return this.test.questions}constructor(e,t,s){this._form=e,this._core=t,this._http=s,this.questionIndex=0,this.form=this._form.getForm("testQuestions",{formId:"testQuestions",title:"Question",components:[{name:"Text",key:"question",focused:!0,fields:[{name:"Placeholder",value:"fill questions text"},{name:"Label",value:"Text"}]},{name:"Select",key:"type",fields:[{name:"Placeholder",value:"select questions type"},{name:"Label",value:"Type"},{name:"Items",value:["Text","Radio","Checkbox","ArrayTexts","TwoArrayConnects"]}]},{name:"Tags",key:"answers",hidden:!0,fields:[{name:"Button",value:"Add answers"},{name:"Placeholder",value:"fill questions answers"},{name:"Label",value:"Answers"}]},{name:"Tags",key:"connectTo",hidden:!0,fields:[{name:"Button",value:"Add connectTo"},{name:"Placeholder",value:"fill questions connections"},{name:"Label",value:"ConnectTo"}]},{name:"Text",key:"text",hidden:!0,fields:[{name:"Placeholder",value:"fill answer text"},{name:"Label",value:"Answer"}]},{name:"Text",key:"radio",hidden:!0,fields:[{name:"Button",value:"Add correct answer"},{name:"Placeholder",value:"fill correct answer"},{name:"Label",value:"Correct Answer"}]},{name:"Tags",key:"checkboxes",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]},{name:"Tags",key:"arrayTexts",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]},{name:"Tags",key:"twoArrayConnects",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]}]})}ngOnInit(){this.change(),this._http.post("/api/school/test/get",this.test,e=>{if(e)for(let t=0;t<this.test.questions.length;t++)this.test.questions[t]=T(T({},this.test.questions[t]),e.answers[t])})}change(){let e=this.questions[this.questionIndex];this.form.components[2].hidden=!e.type||e.type==="Text",this.form.components[3].hidden=e.type!=="TwoArrayConnects",this.form.components[4].hidden=e.type!=="Text",this.form.components[5].hidden=e.type!=="Radio",this.form.components[6].hidden=e.type!=="Checkbox",this.form.components[7].hidden=e.type!=="ArrayTexts",this.form.components[8].hidden=e.type!=="TwoArrayConnects",this.updateAfterWhile()}addQuestion(){this.test.questions.push({}),this.change()}update(){this._http.post("/api/school/test/update",this.test)}updateAfterWhile(){this._core.afterWhile("question",this.update.bind(this),2e3)}};o.\u0275fac=function(t){return new(t||o)(r(C),r(y),r(B))},o.\u0275cmp=v({type:o,selectors:[["app-test-questions"]],standalone:!1,decls:3,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"click"],[3,"submition","config","wChange",4,"ngIf"],[3,"wChange","submition","config"]],template:function(t,s){t&1&&(b(0,Z,6,1,"div",0),u(1,"wbutton",1),d("click",function(){return s.addQuestion()}),w(2,"Add question"),h()),t&2&&m("ngForOf",s.questions)},dependencies:[F,j,P,N],encapsulation:2});let i=o;return i})();var p=(()=>{let o=class o{get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}get rows(){return this.moduleType?this._schooltestService.byId[this.moduleType][this.moduleId]:this._schooltestService.schooltests}constructor(e,t,s,c,g,$,z,G){this._translate=e,this._schooltestService=t,this._alert=s,this._form=c,this._core=g,this._router=$,this._modal=z,this._us=G,this.columns=["_id","title","duration"],this.moduleType=this._router.url.includes("/tests/")?this._router.url.split("/")[this._router.url.split("/").length-2]:"",this.moduleId=this._router.url.includes("/tests/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schooltest",W),this.config={create:this.hasAccess?()=>{this._form.modal(this.form,{label:"Create",click:(n,x)=>{this._preCreate(n),this._schooltestService.create(n),x()}})}:null,update:this.hasAccess?n=>{this._form.modal(this.form,[],n).then(x=>{this._core.copy(x,n),this._schooltestService.update(n)})}:null,delete:this.hasAccess?n=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schooltest?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schooltestService.delete(n)}}]})}:null,buttons:[this.hasAccess?{icon:"assignment_turned_in",click:n=>{n.questions=n.questions||[],this._modal.show({component:Y,test:n})}}:null,this.hasAccess?{icon:"cloud_download",click:n=>{this._form.modalUnique("tests","url",n)}}:null,{icon:"card_membership",hrefFunc:n=>this._roleUrl()+"certificates/test/"+n._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]}}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.rows).then(t=>{if(e)for(let s of t)this._preCreate(s),this._schooltestService.create(s);else{for(let s of this.rows)t.find(c=>c._id===s._id)||this._schooltestService.delete(s);for(let s of t){let c=this.rows.find(g=>g._id===s._id);c?(this._core.copy(s,c),this._schooltestService.update(c)):(this._preCreate(s),this._schooltestService.create(s))}}})}}_preCreate(e){switch(delete e.__created,this.moduleType){case"course":e.course=this.moduleId;break;case"lesson":e.lesson=this.moduleId;break;case"school":e.school=this.moduleId;break}}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}};o.\u0275fac=function(t){return new(t||o)(r(D),r(U),r(M),r(C),r(y),r(Q),r(V),r(O))},o.\u0275cmp=v({type:o,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Tests",3,"columns","config","rows"]],template:function(t,s){t&1&&S(0,"wtable",0),t&2&&m("columns",s.columns)("config",s.config)("rows",s.rows)},dependencies:[E],encapsulation:2});let i=o;return i})();var ee=[{path:"",component:p},{path:"school/:schooltest",component:p},{path:"course/:schooltest",component:p},{path:"lesson/:schooltest",component:p}],Ce=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=I({type:o}),o.\u0275inj=A({imports:[L.forChild(ee),R]});let i=o;return i})();export{Ce as TestsModule};
